<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µå•†ç³»ç»Ÿ - å•†å“ç®¡ç† (Phase 3 Demo)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #333;
            font-size: 24px;
        }

        .header .user-badge {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header .user-info {
            text-align: right;
        }

        .header .user-name {
            font-weight: 600;
            color: #333;
        }

        .header .user-role {
            font-size: 12px;
            color: #666;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        .sidebar {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .sidebar h3 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .filter-group {
            margin-bottom: 20px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-size: 14px;
            font-weight: 500;
        }

        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }

        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .main-content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .search-box {
            display: flex;
            gap: 10px;
            flex: 1;
            max-width: 500px;
        }

        .search-box input {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .product-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s;
        }

        .product-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
            transform: translateY(-5px);
        }

        .product-card .product-image {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, #e0e0e0 0%, #f5f5f5 100%);
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .product-card h4 {
            color: #333;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .product-card .product-category {
            color: #667eea;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .product-card .product-price {
            color: #dc3545;
            font-size: 20px;
            font-weight: 700;
            margin: 10px 0;
        }

        .product-card .product-stock {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .product-card .product-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .product-card .product-actions button {
            flex: 1;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .pagination button {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }

        .pagination button:hover:not(:disabled) {
            background: #667eea;
            color: white;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination .page-info {
            font-weight: 600;
            color: #333;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .form-actions button {
            flex: 1;
        }

        .message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            font-size: 14px;
        }

        .message.show {
            display: block;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-card .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state .icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            color: #666;
            margin-bottom: 10px;
        }

        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .login-box {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .login-box h2 {
            color: #333;
            margin-bottom: 10px;
        }

        .login-box .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .product-tags {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin: 10px 0;
        }

        .product-tag {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            color: #495057;
        }
    </style>
</head>
<body>
    <!-- ç™»å½•é®ç½© -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <h2>ğŸ›ï¸ å•†å“ç®¡ç†ç³»ç»Ÿ</h2>
            <p class="subtitle">Phase 3 - å•†å“ç®¡ç†åŠŸèƒ½æµ‹è¯•</p>
            
            <div id="loginMessage" class="message"></div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">ğŸ“§ ç”µå­é‚®ä»¶</label>
                    <input type="email" id="loginEmail" value="vendor@test.com" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">ğŸ”’ å¯†ç </label>
                    <input type="password" id="loginPassword" value="Vendor123!" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">ç™»å½•</button>
            </form>

            <p style="margin-top: 20px; font-size: 13px; color: #666; text-align: center;">
                ğŸ’¡ æµ‹è¯•è´¦æˆ·ï¼š<br>
                ğŸª <strong>Vendor</strong>: vendor@test.com / Vendor123!<br>
                ğŸ” <strong>Admin</strong>: admin@ecommerce.com / Admin123!<br>
                æˆ–å…ˆåˆ° <a href="frontend_demo.html" target="_blank">è¿™é‡Œæ³¨å†Œ</a>
            </p>
        </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div id="mainApp" style="display: none;">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ›ï¸ å•†å“ç®¡ç†ç³»ç»Ÿ - Phase 3 Demo</h1>
            <div class="user-badge">
                <div class="user-info">
                    <div class="user-name" id="headerUserName"></div>
                    <div class="user-role" id="headerUserRole"></div>
                </div>
                <button onclick="logout()" class="btn btn-danger btn-small">ç™»å‡º</button>
            </div>
        </div>

        <div class="container">
            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalProducts">0</div>
                    <div class="stat-label">ğŸ“¦ æ€»å•†å“æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalCategories">0</div>
                    <div class="stat-label">ğŸ“ åˆ†ç±»æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="currentPage">1</div>
                    <div class="stat-label">ğŸ“„ å½“å‰é¡µ</div>
                </div>
            </div>

            <div class="main-grid">
                <!-- ä¾§è¾¹æ  - ç­›é€‰ -->
                <div class="sidebar">
                    <h3>ğŸ” æœç´¢ä¸ç­›é€‰</h3>
                    
                    <div class="filter-group">
                        <label>æœç´¢å…³é”®è¯</label>
                        <input type="text" id="searchKeyword" placeholder="æœç´¢å•†å“åç§°ã€æè¿°...">
                    </div>

                    <div class="filter-group">
                        <label>å•†å“åˆ†ç±»</label>
                        <select id="filterCategory">
                            <option value="">å…¨éƒ¨åˆ†ç±»</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label>ä»·æ ¼åŒºé—´</label>
                        <input type="number" id="filterMinPrice" placeholder="æœ€ä½ä»·æ ¼" min="0">
                        <input type="number" id="filterMaxPrice" placeholder="æœ€é«˜ä»·æ ¼" min="0" style="margin-top: 5px;">
                    </div>

                    <div class="filter-group">
                        <label>å•†å“çŠ¶æ€</label>
                        <select id="filterStatus">
                            <option value="">å…¨éƒ¨çŠ¶æ€</option>
                            <option value="active">ä¸Šæ¶ä¸­</option>
                            <option value="inactive">å·²ä¸‹æ¶</option>
                            <option value="out_of_stock">ç¼ºè´§</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label>æ’åºæ–¹å¼</label>
                        <select id="sortBy">
                            <option value="created_at">åˆ›å»ºæ—¶é—´</option>
                            <option value="price">ä»·æ ¼</option>
                            <option value="sales_count">é”€é‡</option>
                            <option value="rating">è¯„åˆ†</option>
                            <option value="views">æµè§ˆé‡</option>
                            <option value="name">åç§°</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label>æ’åºæ–¹å‘</label>
                        <select id="sortOrder">
                            <option value="desc">é™åº (é«˜â†’ä½)</option>
                            <option value="asc">å‡åº (ä½â†’é«˜)</option>
                        </select>
                    </div>

                    <button onclick="applyFilters()" class="btn btn-primary" style="width: 100%;">åº”ç”¨ç­›é€‰</button>
                    <button onclick="resetFilters()" class="btn btn-secondary btn-small" style="width: 100%; margin-top: 10px;">é‡ç½®</button>
                </div>

                <!-- ä¸»å†…å®¹åŒº -->
                <div class="main-content">
                    <div id="mainMessage" class="message"></div>

                    <!-- å·¥å…·æ  -->
                    <div class="toolbar">
                        <div class="search-box">
                            <input type="text" id="quickSearch" placeholder="å¿«é€Ÿæœç´¢..." onkeypress="if(event.key==='Enter') quickSearch()">
                            <button onclick="quickSearch()" class="btn btn-primary">æœç´¢</button>
                        </div>
                        <button onclick="showCreateModal()" class="btn btn-success" id="btnCreate">
                            â• åˆ›å»ºå•†å“
                        </button>
                    </div>

                    <!-- å•†å“åˆ—è¡¨ -->
                    <div id="productsContainer" class="products-grid"></div>

                    <!-- åˆ†é¡µ -->
                    <div class="pagination">
                        <button onclick="goToPage(currentPage - 1)" id="btnPrevPage">
                            â† ä¸Šä¸€é¡µ
                        </button>
                        <span class="page-info">
                            ç¬¬ <span id="pageNumber">1</span> é¡µ / å…± <span id="totalPages">1</span> é¡µ
                        </span>
                        <button onclick="goToPage(currentPage + 1)" id="btnNextPage">
                            ä¸‹ä¸€é¡µ â†’
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ›å»º/ç¼–è¾‘å•†å“ Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <h2 id="modalTitle">ğŸ›ï¸ åˆ›å»ºå•†å“</h2>
            <p style="color: #666; margin-bottom: 10px; font-size: 14px;">
                å¡«å†™å•†å“ä¿¡æ¯ï¼Œæ ‡æœ‰ * çš„ä¸ºå¿…å¡«é¡¹
            </p>
            <button type="button" onclick="fillSampleData()" class="btn btn-secondary btn-small" style="margin-bottom: 15px;">
                âš¡ å¿«é€Ÿå¡«å……ç¤ºä¾‹æ•°æ®
            </button>
            
            <form id="productForm">
                <!-- åŸºæœ¬ä¿¡æ¯ -->
                <h3 style="color: #667eea; margin: 20px 0 15px 0; font-size: 16px; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px;">
                    ğŸ“ åŸºæœ¬ä¿¡æ¯
                </h3>
                
                <div class="form-group">
                    <label>å•†å“åç§° *</label>
                    <input type="text" id="productName" placeholder="ä¾‹å¦‚ï¼šiPhone 15 Pro Max 256GB" required>
                    <small style="color: #666; font-size: 12px;">æ¸…æ™°å‡†ç¡®çš„å•†å“åç§°æœ‰åŠ©äºç”¨æˆ·æœç´¢</small>
                </div>

                <div class="form-group">
                    <label>å•†å“åˆ†ç±» *</label>
                    <input type="text" id="productCategory" placeholder="ä¾‹å¦‚ï¼šæ‰‹æ©Ÿã€ç­†è¨˜å‹é›»è…¦ã€å¹³æ¿" list="categoryList" required>
                    <datalist id="categoryList">
                        <option value="æ‰‹æ©Ÿ">
                        <option value="ç­†è¨˜å‹é›»è…¦">
                        <option value="å¹³æ¿">
                        <option value="é›»è…¦é…ä»¶">
                        <option value="æ™ºèƒ½æ‰‹éŒ¶">
                        <option value="è€³æ©ŸéŸ³éŸ¿">
                    </datalist>
                    <small style="color: #666; font-size: 12px;">é€‰æ‹©æˆ–è¾“å…¥æ–°åˆ†ç±»</small>
                </div>

                <div class="form-group">
                    <label>å•†å“æè¿° *</label>
                    <textarea id="productDescription" rows="4" placeholder="è¯¦ç»†æè¿°å•†å“çš„ç‰¹ç‚¹ã€åŠŸèƒ½ã€è§„æ ¼ç­‰..." required></textarea>
                    <small style="color: #666; font-size: 12px;">å»ºè®®è‡³å°‘ 50 å­—ï¼Œè¯¦ç»†æè¿°èƒ½æé«˜è½¬åŒ–ç‡</small>
                </div>

                <div class="form-group">
                    <label>æ ‡ç­¾å…³é”®è¯</label>
                    <input type="text" id="productTags" placeholder="ä¾‹å¦‚: Apple, iPhone, 5G, æ‹ç…§">
                    <small style="color: #666; font-size: 12px;">ç”¨é€—å·åˆ†éš”ï¼Œæœ‰åŠ©äºæœç´¢å’Œæ¨è</small>
                </div>

                <!-- ä»·æ ¼ä¸åº“å­˜ -->
                <h3 style="color: #667eea; margin: 20px 0 15px 0; font-size: 16px; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px;">
                    ğŸ’° ä»·æ ¼ä¸åº“å­˜
                </h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>é”€å”®ä»·æ ¼ (å…ƒ) *</label>
                        <input type="number" id="productPrice" step="0.01" min="0" placeholder="0.00" required>
                        <small style="color: #666; font-size: 12px;">ç”¨æˆ·è´­ä¹°æ—¶çš„ä»·æ ¼</small>
                    </div>

                    <div class="form-group">
                        <label>åº“å­˜æ•°é‡ *</label>
                        <input type="number" id="productStock" min="0" placeholder="0" required>
                        <small style="color: #666; font-size: 12px;">å½“å‰å¯å”®åº“å­˜</small>
                    </div>
                </div>

                <!-- å•†å“åª’ä½“ -->
                <h3 style="color: #667eea; margin: 20px 0 15px 0; font-size: 16px; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px;">
                    ğŸ“· å•†å“å›¾ç‰‡
                </h3>

                <div class="form-group">
                    <label>å•†å“å›¾ç‰‡ URL</label>
                    <textarea id="productImages" rows="3" placeholder="æ¯è¡Œä¸€ä¸ªå›¾ç‰‡ URLï¼Œä¾‹å¦‚ï¼š&#10;https://example.com/image1.jpg&#10;https://example.com/image2.jpg"></textarea>
                    <small style="color: #666; font-size: 12px;">
                        ğŸ’¡ å»ºè®®å°ºå¯¸ï¼š800x800pxï¼Œæ”¯æŒå¤šå¼ å›¾ç‰‡ï¼ˆæ¯è¡Œä¸€ä¸ªURLï¼‰<br>
                        ğŸ“Œ å¸¸ç”¨å›¾åºŠï¼š<a href="https://imgur.com" target="_blank">Imgur</a>ã€
                        <a href="https://postimages.org" target="_blank">PostImages</a>
                    </small>
                </div>

                <div class="form-group" id="imagePreview" style="display: none; margin-top: 10px;">
                    <label>å›¾ç‰‡é¢„è§ˆ</label>
                    <div id="imagePreviewContainer" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
                </div>

                <!-- å•†å“çŠ¶æ€ -->
                <h3 style="color: #667eea; margin: 20px 0 15px 0; font-size: 16px; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px;">
                    âš™ï¸ å•†å“è®¾ç½®
                </h3>

                <div class="form-group">
                    <label>å•†å“çŠ¶æ€</label>
                    <select id="productStatus">
                        <option value="active">âœ… ä¸Šæ¶ä¸­ - ç”¨æˆ·å¯ä»¥è´­ä¹°</option>
                        <option value="inactive">âŒ å·²ä¸‹æ¶ - æš‚ä¸é”€å”®</option>
                        <option value="out_of_stock">ğŸ“¦ ç¼ºè´§ - æš‚æ—¶ç¼ºè´§</option>
                    </select>
                </div>

                <!-- æ“ä½œæŒ‰é’® -->
                <div class="form-actions" style="margin-top: 30px;">
                    <button type="button" onclick="closeModal()" class="btn btn-secondary">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary" style="flex: 2;">ğŸ’¾ ä¿å­˜å•†å“</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ==================== å…¨å±€å˜é‡ ====================
        const API_BASE_URL = 'http://127.0.0.1:8000';
        let currentToken = null;
        let currentUser = null;
        let currentPage = 1;
        let pageSize = 12;
        let totalItems = 0;
        let editingProductId = null;

        // ==================== ç™»å½•ç›¸å…³ ====================
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    currentToken = data.data.access_token;
                    currentUser = data.data.user;
                    
                    // éšè—ç™»å½•é¡µï¼Œæ˜¾ç¤ºä¸»ç•Œé¢
                    document.getElementById('loginOverlay').style.display = 'none';
                    document.getElementById('mainApp').style.display = 'block';
                    
                    // æ›´æ–°å¤´éƒ¨ç”¨æˆ·ä¿¡æ¯
                    document.getElementById('headerUserName').textContent = currentUser.full_name || currentUser.email;
                    document.getElementById('headerUserRole').textContent = `è§’è‰²: ${currentUser.role}`;
                    
                    // æ£€æŸ¥æƒé™ï¼Œæ˜¾ç¤º/éšè—åˆ›å»ºæŒ‰é’®
                    if (currentUser.role === 'customer') {
                        document.getElementById('btnCreate').style.display = 'none';
                    }
                    
                    // åŠ è½½å•†å“åˆ—è¡¨
                    await loadProducts();
                    await loadCategories();
                    
                    showMessage('âœ… ç™»å½•æˆåŠŸï¼', 'success');
                } else {
                    showLoginMessage('âŒ ' + (data.error?.message || 'ç™»å½•å¤±è´¥'), 'error');
                }
            } catch (error) {
                showLoginMessage('âŒ è¿æ¥æœåŠ¡å™¨å¤±è´¥', 'error');
                console.error('ç™»å½•é”™è¯¯:', error);
            }
        });

        function logout() {
            currentToken = null;
            currentUser = null;
            document.getElementById('loginOverlay').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        }

        function showLoginMessage(text, type) {
            const msg = document.getElementById('loginMessage');
            msg.textContent = text;
            msg.className = `message ${type} show`;
        }

        function showMessage(text, type) {
            const msg = document.getElementById('mainMessage');
            msg.textContent = text;
            msg.className = `message ${type} show`;
            setTimeout(() => {
                msg.classList.remove('show');
            }, 3000);
        }

        // ==================== å•†å“åŠ è½½ ====================
        async function loadProducts(filters = {}) {
            try {
                // æ„å»ºæŸ¥è¯¢å‚æ•°
                const params = new URLSearchParams({
                    page: currentPage,
                    page_size: pageSize
                });

                if (filters.search) params.append('search', filters.search);
                if (filters.category) params.append('category', filters.category);
                if (filters.min_price) params.append('min_price', filters.min_price);
                if (filters.max_price) params.append('max_price', filters.max_price);
                if (filters.status) params.append('status', filters.status);
                if (filters.sort_by) params.append('sort_by', filters.sort_by);
                if (filters.order) params.append('order', filters.order);

                const response = await fetch(`${API_BASE_URL}/api/v1/products?${params}`);
                const data = await response.json();

                if (response.ok) {
                    displayProducts(data.data.items);
                    updatePagination(data.data);
                    updateStats(data.data);
                } else {
                    showMessage('âŒ åŠ è½½å•†å“å¤±è´¥', 'error');
                }
            } catch (error) {
                showMessage('âŒ è¿æ¥æœåŠ¡å™¨å¤±è´¥', 'error');
                console.error('åŠ è½½å•†å“é”™è¯¯:', error);
            }
        }

        function displayProducts(products) {
            const container = document.getElementById('productsContainer');
            
            if (products.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="icon">ğŸ“¦</div>
                        <h3>æš‚æ— å•†å“</h3>
                        <p>è¯•è¯•åˆ›å»ºç¬¬ä¸€ä¸ªå•†å“å§ï¼</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = products.map(product => `
                <div class="product-card">
                    <div class="product-image">${getProductIcon(product.category)}</div>
                    <div class="product-category">${product.category}</div>
                    <h4>${product.name}</h4>
                    <p style="font-size: 12px; color: #666; margin: 5px 0;">${truncate(product.description, 50)}</p>
                    
                    ${product.tags && product.tags.length > 0 ? `
                        <div class="product-tags">
                            ${product.tags.slice(0, 3).map(tag => `<span class="product-tag">${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                    
                    <div class="product-price">Â¥${product.price.toLocaleString()}</div>
                    <div class="product-stock">
                        åº“å­˜: ${product.stock} | 
                        é”€é‡: ${product.sales_count || 0} | 
                        æµè§ˆ: ${product.views || 0}
                    </div>
                    
                    ${currentUser && (currentUser.role === 'admin' || currentUser.role === 'vendor') ? `
                        <div class="product-actions">
                            <button onclick="viewProduct('${product.id}')" class="btn btn-primary btn-small">æŸ¥çœ‹</button>
                            <button onclick="editProduct('${product.id}')" class="btn btn-secondary btn-small">ç¼–è¾‘</button>
                            <button onclick="deleteProduct('${product.id}')" class="btn btn-danger btn-small">åˆ é™¤</button>
                        </div>
                    ` : `
                        <button onclick="viewProduct('${product.id}')" class="btn btn-primary" style="width: 100%;">æŸ¥çœ‹è¯¦æƒ…</button>
                    `}
                </div>
            `).join('');
        }

        function getProductIcon(category) {
            const icons = {
                'ç­†è¨˜å‹é›»è…¦': 'ğŸ’»',
                'Laptop': 'ğŸ’»',
                'Phone': 'ğŸ“±',
                'æ‰‹æ©Ÿ': 'ğŸ“±',
                'å¹³æ¿': 'ğŸ“±',
                'é›»è…¦': 'ğŸ–¥ï¸',
                'é…ä»¶': 'ğŸ§',
                'å…¶ä»–': 'ğŸ“¦'
            };
            return icons[category] || 'ğŸ“¦';
        }

        function truncate(str, length) {
            return str.length > length ? str.substring(0, length) + '...' : str;
        }

        function updatePagination(data) {
            totalItems = data.pagination.total;
            const totalPages = data.pagination.total_pages;
            
            document.getElementById('pageNumber').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;
            
            document.getElementById('btnPrevPage').disabled = currentPage === 1;
            document.getElementById('btnNextPage').disabled = currentPage === totalPages || totalPages === 0;
        }

        function updateStats(data) {
            document.getElementById('totalProducts').textContent = data.pagination.total;
            document.getElementById('currentPage').textContent = currentPage;
        }

        function goToPage(page) {
            if (page < 1) return;
            currentPage = page;
            applyFilters();
        }

        // ==================== ç­›é€‰åŠŸèƒ½ ====================
        async function applyFilters() {
            const filters = {
                search: document.getElementById('searchKeyword').value,
                category: document.getElementById('filterCategory').value,
                min_price: document.getElementById('filterMinPrice').value,
                max_price: document.getElementById('filterMaxPrice').value,
                status: document.getElementById('filterStatus').value,
                sort_by: document.getElementById('sortBy').value,
                order: document.getElementById('sortOrder').value
            };

            await loadProducts(filters);
        }

        function resetFilters() {
            document.getElementById('searchKeyword').value = '';
            document.getElementById('filterCategory').value = '';
            document.getElementById('filterMinPrice').value = '';
            document.getElementById('filterMaxPrice').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('sortBy').value = 'created_at';
            document.getElementById('sortOrder').value = 'desc';
            currentPage = 1;
            loadProducts();
        }

        async function quickSearch() {
            const keyword = document.getElementById('quickSearch').value;
            document.getElementById('searchKeyword').value = keyword;
            currentPage = 1;
            await applyFilters();
        }

        // ==================== åˆ†ç±»åŠ è½½ ====================
        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/products/categories/all`);
                const data = await response.json();

                if (response.ok) {
                    const select = document.getElementById('filterCategory');
                    const categories = data.data;
                    
                    // æ¸…ç©ºä¹‹å‰çš„åˆ†ç±»é€‰é¡¹ï¼Œåªä¿ç•™"å…¨éƒ¨åˆ†ç±»"
                    select.innerHTML = '<option value="">å…¨éƒ¨åˆ†ç±»</option>';
                    
                    // æ·»åŠ æ–°çš„åˆ†ç±»é€‰é¡¹
                    categories.forEach(cat => {
                        const option = document.createElement('option');
                        option.value = cat;
                        option.textContent = cat;
                        select.appendChild(option);
                    });

                    document.getElementById('totalCategories').textContent = categories.length;
                }
            } catch (error) {
                console.error('åŠ è½½åˆ†ç±»é”™è¯¯:', error);
            }
        }

        // ==================== å›¾ç‰‡é¢„è§ˆåŠŸèƒ½ ====================
        document.getElementById('productImages').addEventListener('input', function() {
            const imageUrls = this.value.split('\n').map(url => url.trim()).filter(url => url);
            const previewContainer = document.getElementById('imagePreviewContainer');
            const previewSection = document.getElementById('imagePreview');
            
            if (imageUrls.length > 0) {
                previewSection.style.display = 'block';
                previewContainer.innerHTML = imageUrls.map(url => `
                    <div style="position: relative;">
                        <img src="${url}" 
                             style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px; border: 2px solid #e0e0e0;"
                             onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27100%27 height=%27100%27%3E%3Crect fill=%27%23ddd%27 width=%27100%27 height=%27100%27/%3E%3Ctext x=%2750%25%27 y=%2750%25%27 dominant-baseline=%27middle%27 text-anchor=%27middle%27 fill=%27%23999%27 font-size=%2712%27%3EåŠ è½½å¤±è´¥%3C/text%3E%3C/svg%3E'"
                             alt="å•†å“å›¾ç‰‡">
                    </div>
                `).join('');
            } else {
                previewSection.style.display = 'none';
            }
        });

        // ==================== å¿«é€Ÿå¡«å……ç¤ºä¾‹æ•°æ® ====================
        function fillSampleData() {
            const samples = [
                {
                    name: 'MacBook Pro 14" M3 Pro èŠ¯ç‰‡',
                    category: 'ç­†è¨˜å‹é›»è…¦',
                    description: 'Apple M3 Pro èŠ¯ç‰‡ï¼Œå…·æœ‰ 11 æ ¸ä¸­å¤®å¤„ç†å™¨å’Œ 14 æ ¸å›¾å½¢å¤„ç†å™¨\n18GB ç»Ÿä¸€å†…å­˜\n512GB å›ºæ€ç¡¬ç›˜\n14.2 è‹±å¯¸ Liquid Retina XDR æ˜¾ç¤ºå±\nä¸‰ä¸ª Thunderbolt 4 ç«¯å£ï¼ŒHDMI ç«¯å£ï¼ŒSDXC å¡æ’æ§½ï¼ŒMagSafe 3 ç«¯å£\nèƒŒå…‰å¦™æ§é”®ç›˜ï¼Œé…å¤‡è§¦æ§ ID - ä¸­æ–‡ï¼ˆæ‹¼éŸ³ï¼‰',
                    price: 16999,
                    stock: 50,
                    tags: 'Apple, MacBook, M3, ç¬”è®°æœ¬ç”µè„‘, ä¸“ä¸šå·¥ä½œç«™',
                    images: 'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=800\nhttps://images.unsplash.com/photo-1496181133206-80ce9b88a853?w=800',
                    status: 'active'
                },
                {
                    name: 'iPhone 15 Pro Max 256GB åŸè‰²é’›é‡‘å±',
                    category: 'æ‰‹æ©Ÿ',
                    description: 'é’›é‡‘å±è®¾è®¡\nA17 Pro èŠ¯ç‰‡ï¼Œ6 æ ¸ä¸­å¤®å¤„ç†å™¨ï¼Œ6 æ ¸å›¾å½¢å¤„ç†å™¨ï¼Œ16 æ ¸ç¥ç»ç½‘ç»œå¼•æ“\n6.7 è‹±å¯¸è¶…è§†ç½‘è†œ XDR æ˜¾ç¤ºå±ï¼Œé‡‡ç”¨ ProMotion è‡ªé€‚åº”åˆ·æ–°ç‡æŠ€æœ¯\n4800 ä¸‡åƒç´ ä¸»æ‘„ï¼Œæ”¯æŒè¶…é«˜åˆ†è¾¨ç‡ç…§ç‰‡\n1200 ä¸‡åƒç´ è¶…å¹¿è§’æ‘„åƒå¤´\n1200 ä¸‡åƒç´  3 å€é•¿ç„¦æ‘„åƒå¤´\né¢å®¹ ID\næ”¯æŒ 5G ç½‘ç»œ',
                    price: 9999,
                    stock: 100,
                    tags: 'Apple, iPhone, 5G, æ™ºèƒ½æ‰‹æœº, Pro',
                    images: 'data:image/webp;base64,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\ndata:image/jpeg;base64,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',
                    status: 'active'
                },
                {
                    name: 'AirPods Pro (ç¬¬äºŒä»£) USB-C',
                    category: 'è€³æ©ŸéŸ³éŸ¿',
                    description: 'ä¸»åŠ¨é™å™ªåŠŸèƒ½ï¼Œå¯é˜»éš”å¤–ç•Œå™ªéŸ³\nè‡ªé€‚åº”é€šé€æ¨¡å¼ï¼Œè®©ä½ è‡ªç„¶åœ°å¬åˆ°å‘¨å›´ç¯å¢ƒçš„å£°éŸ³\nä¸ªæ€§åŒ–ç©ºé—´éŸ³é¢‘ï¼Œä¸ºä½ å¸¦æ¥èº«ä¸´å…¶å¢ƒçš„è†å¬ä½“éªŒ\nå•æ¬¡å……ç”µå¯ä½¿ç”¨é•¿è¾¾ 6 å°æ—¶ï¼Œé…åˆå……ç”µç›’å¯ä½¿ç”¨æœ€é•¿è¾¾ 30 å°æ—¶\nè½»æ¾è®¾ç½®ï¼Œå¯åœ¨ä½ æ‰€æœ‰ Apple è®¾å¤‡ä¹‹é—´å³æ—¶åˆ‡æ¢\nIP54 é˜²å°˜é˜²æ°´\næ”¯æŒç²¾ç¡®æŸ¥æ‰¾åŠŸèƒ½',
                    price: 1899,
                    stock: 200,
                    tags: 'Apple, AirPods, æ— çº¿è€³æœº, é™å™ª, éŸ³é¢‘',
                    images: 'https://images.unsplash.com/photo-1606841837239-c5a1a4a07af7?w=800\nhttps://images.unsplash.com/photo-1588156979435-379b9a769f0c?w=800',
                    status: 'active'
                },
                {
                    name: 'iPad Pro 12.9" M2 èŠ¯ç‰‡ 256GB Wi-Fi',
                    category: 'å¹³æ¿',
                    description: 'Apple M2 èŠ¯ç‰‡ï¼Œ8 æ ¸ä¸­å¤®å¤„ç†å™¨ï¼Œ10 æ ¸å›¾å½¢å¤„ç†å™¨\n12.9 è‹±å¯¸ Liquid Retina XDR æ˜¾ç¤ºå±\n256GB å­˜å‚¨å®¹é‡\n1200 ä¸‡åƒç´ å¹¿è§’æ‘„åƒå¤´ï¼Œ1000 ä¸‡åƒç´ è¶…å¹¿è§’æ‘„åƒå¤´\n1200 ä¸‡åƒç´ è¶…å¹¿è§’å‰ç½®æ‘„åƒå¤´ï¼Œæ”¯æŒäººç‰©å±…ä¸­åŠŸèƒ½\né¢å®¹ ID\næ”¯æŒ Apple Pencil (ç¬¬äºŒä»£)\næ”¯æŒå¦™æ§é”®ç›˜',
                    price: 8999,
                    stock: 30,
                    tags: 'Apple, iPad, å¹³æ¿ç”µè„‘, M2, åˆ›æ„å·¥ä½œ',
                    images: 'https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=800\nhttps://images.unsplash.com/photo-1585790050230-5dd28404f28c?w=800',
                    status: 'active'
                }
            ];

            const sample = samples[Math.floor(Math.random() * samples.length)];
            
            document.getElementById('productName').value = sample.name;
            document.getElementById('productCategory').value = sample.category;
            document.getElementById('productDescription').value = sample.description;
            document.getElementById('productPrice').value = sample.price;
            document.getElementById('productStock').value = sample.stock;
            document.getElementById('productTags').value = sample.tags;
            document.getElementById('productImages').value = sample.images;
            document.getElementById('productStatus').value = sample.status;
            
            // è§¦å‘å›¾ç‰‡é¢„è§ˆ
            document.getElementById('productImages').dispatchEvent(new Event('input'));
            
            showMessage('âœ… å·²å¡«å……ç¤ºä¾‹å•†å“æ•°æ®ï¼Œå¯ä»¥ç›´æ¥ä¿å­˜æˆ–ä¿®æ”¹åä¿å­˜', 'success');
        }

        // ==================== åˆ›å»º/ç¼–è¾‘å•†å“ ====================
        function showCreateModal() {
            editingProductId = null;
            document.getElementById('modalTitle').textContent = 'ğŸ›ï¸ åˆ›å»ºå•†å“';
            document.getElementById('productForm').reset();
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('productModal').classList.add('show');
        }

        async function editProduct(productId) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/products/${productId}`);
                const data = await response.json();

                if (response.ok) {
                    const product = data.data;
                    editingProductId = productId;
                    
                    document.getElementById('modalTitle').textContent = 'âœï¸ ç¼–è¾‘å•†å“';
                    document.getElementById('productName').value = product.name;
                    document.getElementById('productDescription').value = product.description;
                    document.getElementById('productPrice').value = product.price;
                    document.getElementById('productStock').value = product.stock;
                    document.getElementById('productCategory').value = product.category;
                    document.getElementById('productTags').value = product.tags.join(', ');
                    // æ¯è¡Œä¸€ä¸ªå›¾ç‰‡ URL
                    document.getElementById('productImages').value = product.images.join('\n');
                    document.getElementById('productStatus').value = product.status;
                    
                    // è§¦å‘å›¾ç‰‡é¢„è§ˆ
                    document.getElementById('productImages').dispatchEvent(new Event('input'));
                    
                    document.getElementById('productModal').classList.add('show');
                } else {
                    showMessage('âŒ åŠ è½½å•†å“å¤±è´¥', 'error');
                }
            } catch (error) {
                showMessage('âŒ è¿æ¥æœåŠ¡å™¨å¤±è´¥', 'error');
                console.error('åŠ è½½å•†å“é”™è¯¯:', error);
            }
        }

        function closeModal() {
            document.getElementById('productModal').classList.remove('show');
            editingProductId = null;
        }

        document.getElementById('productForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            // å¤„ç†å›¾ç‰‡ URLï¼ˆæ”¯æŒæ¢è¡Œåˆ†éš”ï¼‰
            const imagesText = document.getElementById('productImages').value;
            const imageUrls = imagesText
                .split(/[\n,]/)  // æ”¯æŒæ¢è¡Œæˆ–é€—å·åˆ†éš”
                .map(url => url.trim())
                .filter(url => url && url.startsWith('http'));

            const productData = {
                name: document.getElementById('productName').value.trim(),
                description: document.getElementById('productDescription').value.trim(),
                price: parseFloat(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                category: document.getElementById('productCategory').value.trim(),
                tags: document.getElementById('productTags').value
                    .split(',')
                    .map(t => t.trim())
                    .filter(t => t),
                images: imageUrls,
                status: document.getElementById('productStatus').value
            };

            try {
                const url = editingProductId 
                    ? `${API_BASE_URL}/api/v1/products/${editingProductId}`
                    : `${API_BASE_URL}/api/v1/products`;
                
                const method = editingProductId ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify(productData)
                });

                const data = await response.json();

                if (response.ok) {
                    showMessage(`âœ… å•†å“${editingProductId ? 'æ›´æ–°' : 'åˆ›å»º'}æˆåŠŸï¼`, 'success');
                    closeModal();
                    await loadProducts();
                    await loadCategories();
                } else {
                    showMessage('âŒ ' + (data.error?.message || 'æ“ä½œå¤±è´¥'), 'error');
                }
            } catch (error) {
                showMessage('âŒ è¿æ¥æœåŠ¡å™¨å¤±è´¥', 'error');
                console.error('ä¿å­˜å•†å“é”™è¯¯:', error);
            }
        });

        // ==================== åˆ é™¤å•†å“ ====================
        async function deleteProduct(productId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå•†å“å—ï¼Ÿ')) return;

            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/products/${productId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    showMessage('âœ… å•†å“åˆ é™¤æˆåŠŸï¼', 'success');
                    await loadProducts();
                } else {
                    showMessage('âŒ ' + (data.error?.message || 'åˆ é™¤å¤±è´¥'), 'error');
                }
            } catch (error) {
                showMessage('âŒ è¿æ¥æœåŠ¡å™¨å¤±è´¥', 'error');
                console.error('åˆ é™¤å•†å“é”™è¯¯:', error);
            }
        }

        // ==================== æŸ¥çœ‹å•†å“è¯¦æƒ… ====================
        async function viewProduct(productId) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/v1/products/${productId}`);
                const data = await response.json();

                if (response.ok) {
                    const product = data.data;
                    alert(`å•†å“è¯¦æƒ…ï¼š\n\n` +
                        `åç§°: ${product.name}\n` +
                        `æè¿°: ${product.description}\n` +
                        `ä»·æ ¼: Â¥${product.price}\n` +
                        `åº“å­˜: ${product.stock}\n` +
                        `åˆ†ç±»: ${product.category}\n` +
                        `çŠ¶æ€: ${product.status}\n` +
                        `é”€é‡: ${product.sales_count || 0}\n` +
                        `æµè§ˆ: ${product.views || 0}\n` +
                        `è¯„åˆ†: ${product.rating || 0}\n` +
                        `æ ‡ç­¾: ${product.tags.join(', ')}`
                    );
                } else {
                    showMessage('âŒ åŠ è½½å•†å“å¤±è´¥', 'error');
                }
            } catch (error) {
                showMessage('âŒ è¿æ¥æœåŠ¡å™¨å¤±è´¥', 'error');
                console.error('æŸ¥çœ‹å•†å“é”™è¯¯:', error);
            }
        }

        // ==================== é¡µé¢åŠ è½½ ====================
        console.log('ğŸ‰ å•†å“ç®¡ç† Demo å·²åŠ è½½ï¼');
        console.log('ğŸ“¡ API åœ°å€:', API_BASE_URL);
        console.log('ğŸ’¡ Phase 3 - å®Œæ•´çš„å•†å“ç®¡ç†åŠŸèƒ½æµ‹è¯•');
    </script>
</body>
</html>

