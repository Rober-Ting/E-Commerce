# ğŸ“Š æµ‹è¯•è¦†ç›–ç‡å¿«é€Ÿå¼€å§‹

## âœ… å·²å®Œæˆè®¾ç½®

- âœ… pytest-cov å·²å®‰è£…
- âœ… pytest.ini å·²é…ç½®
- âœ… VS Code è®¾ç½®å·²æ›´æ–°

---

## ğŸš€ ä¸‰ç§ä½¿ç”¨æ–¹å¼

### 1ï¸âƒ£ VS Code æµ‹è¯•é¢æ¿ï¼ˆæœ€ç®€å• â­â­â­ï¼‰

```
1. æ‰“å¼€æµ‹è¯•é¢æ¿ï¼ˆå·¦ä¾§çƒ§æ¯å›¾æ ‡ ğŸ§ªï¼‰
2. å³é”®æµ‹è¯•æˆ–æµ‹è¯•ç±»
3. é€‰æ‹© "Run Test with Coverage"
4. æŸ¥çœ‹è¦†ç›–ç‡ï¼
```

---

### 2ï¸âƒ£ å‘½ä»¤è¡Œï¼ˆæœ€è¯¦ç»† â­â­â­â­ï¼‰

```powershell
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.\venv\Scripts\activate

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆ HTML æŠ¥å‘Š
pytest tests/test_day4_5.py --cov=app --cov-report=html --cov-report=term-missing

# æŸ¥çœ‹ HTML æŠ¥å‘Š
start htmlcov/index.html
```

---

### 3ï¸âƒ£ å¿«é€ŸæŸ¥çœ‹ï¼ˆæœ€å¿«ï¼‰

```powershell
# åªæ˜¾ç¤ºç»ˆç«¯æŠ¥å‘Š
pytest tests/ --cov=app --cov-report=term
```

---

## ğŸ“Š ä½ ä¼šçœ‹åˆ°ä»€ä¹ˆ

### ç»ˆç«¯è¾“å‡ºï¼š

```
Name                              Stmts   Miss  Cover   Missing
---------------------------------------------------------------
app\models\common.py                 59      0   100%
app\utils\helpers.py                 96     48    50%   76, 95-108, 161-171
app\middleware\error_handler.py      75     33    56%   77-83, 95, 106
---------------------------------------------------------------
TOTAL                               482    311    35%

HTML coverage report generated: htmlcov\index.html
```

**è§£è¯»ï¼š**
- **Stmts**: ä»£ç è¯­å¥æ€»æ•°
- **Miss**: æœªè¢«æµ‹è¯•çš„è¯­å¥æ•°
- **Cover**: è¦†ç›–ç‡ç™¾åˆ†æ¯”
- **Missing**: æœªè¦†ç›–çš„å…·ä½“è¡Œå·

---

### HTML æŠ¥å‘Šï¼š

æ‰“å¼€ `htmlcov/index.html`ï¼Œä½ ä¼šçœ‹åˆ°ï¼š

1. **æ€»è§ˆé¡µé¢** - æ‰€æœ‰æ–‡ä»¶çš„è¦†ç›–ç‡
2. **æ–‡ä»¶è¯¦æƒ…** - ç‚¹å‡»æ–‡ä»¶åæŸ¥çœ‹
   - ğŸŸ¢ ç»¿è‰² = è¢«æµ‹è¯•è¦†ç›–
   - ğŸ”´ çº¢è‰² = æ²¡æœ‰è¢«æµ‹è¯•

---

## ğŸ’¡ ç†è§£è¦†ç›–ç‡

### å½“å‰é¡¹ç›®è¦†ç›–ç‡

è¿è¡Œæµ‹è¯•åä½ ä¼šçœ‹åˆ°ï¼š

```
app\models\common.py         100%  âœ… éå¸¸å¥½ï¼
app\utils\helpers.py          50%  âš ï¸ éœ€è¦æ›´å¤šæµ‹è¯•
app\middleware\error_handler.py  56%  âš ï¸ éœ€è¦æ›´å¤šæµ‹è¯•
app\utils\logging_config.py   24%  âŒ éœ€è¦å¤§é‡æµ‹è¯•
```

**ä¸ºä»€ä¹ˆæœ‰äº›è¦†ç›–ç‡ä½ï¼Ÿ**
- `helpers.py`: æœ‰äº›å·¥å…·å‡½æ•°è¿˜æ²¡æœ‰æµ‹è¯•
- `logging_config.py`: æ—¥å¿—é…ç½®è¾ƒå¤æ‚ï¼Œéœ€è¦æ›´å¤šæµ‹è¯•
- `config.py`, `database.py`, `main.py`: è¿è¡Œæ—¶ä»£ç ï¼Œéœ€è¦é›†æˆæµ‹è¯•

---

## ğŸ¯ è¦†ç›–ç‡è¯„çº§

| è¦†ç›–ç‡ | è¯„çº§ | è¯´æ˜ |
|--------|------|------|
| 90%+ | ä¼˜ç§€ â­â­â­â­â­ | å¾ˆæ£’ï¼|
| 80-90% | è‰¯å¥½ â­â­â­â­ | ä¸é”™ |
| 70-80% | åˆæ ¼ â­â­â­ | å¯ä»¥ |
| 60-70% | éœ€æ”¹è¿› â­â­ | åº”è¯¥æé«˜ |
| < 60% | ä¸è¶³ â­ | éœ€è¦æ›´å¤šæµ‹è¯• |

---

## ğŸ“ å¸¸ç”¨å‘½ä»¤

```powershell
# åŸºæœ¬è¦†ç›–ç‡
pytest tests/ --cov=app

# è¯¦ç»†æŠ¥å‘Š + æ˜¾ç¤ºç¼ºå¤±è¡Œå·
pytest tests/ --cov=app --cov-report=term-missing

# ç”Ÿæˆ HTML æŠ¥å‘Šï¼ˆå¯è§†åŒ–ï¼‰
pytest tests/ --cov=app --cov-report=html

# åªæµ‹è¯•ç‰¹å®šæ¨¡å—
pytest tests/ --cov=app.models --cov-report=term

# è¦æ±‚æœ€ä½è¦†ç›–ç‡ï¼ˆå¦åˆ™æµ‹è¯•å¤±è´¥ï¼‰
pytest tests/ --cov=app --cov-fail-under=80
```

---

## ğŸ” æ‰¾å‡ºæœªæµ‹è¯•çš„ä»£ç 

```powershell
# æ˜¾ç¤ºå“ªäº›è¡Œæ²¡æœ‰è¢«æµ‹è¯•
pytest tests/ --cov=app --cov-report=term-missing
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
app\utils\helpers.py    96   48   50%   76, 95-108, 161-171
                                         ^^^^^^^^^^^^^^^^^^^
                                         è¿™äº›è¡Œæ²¡æœ‰è¢«æµ‹è¯•ï¼
```

**ä¸‹ä¸€æ­¥ï¼š** ä¸ºè¿™äº›è¡Œæ·»åŠ æµ‹è¯•

---

## ğŸ¨ VS Code å¯è§†åŒ–ï¼ˆå¯é€‰ï¼‰

### å®‰è£… Coverage Gutters æ’ä»¶

1. æŒ‰ `Ctrl+Shift+X`
2. æœç´¢ "Coverage Gutters"
3. å®‰è£…

### ä½¿ç”¨

```powershell
# 1. ç”Ÿæˆ XML æŠ¥å‘Š
pytest tests/ --cov=app --cov-report=xml

# 2. åœ¨ VS Code ä¸­æŒ‰ Ctrl+Shift+P
# 3. è¾“å…¥ "Coverage Gutters: Display Coverage"
# 4. ä»£ç å·¦ä¾§ä¼šæ˜¾ç¤ºè¦†ç›–çŠ¶æ€
```

**æ•ˆæœï¼š**
- ğŸŸ¢ ç»¿è‰²æ¡ = ä»£ç è¢«è¦†ç›–
- ğŸ”´ çº¢è‰²æ¡ = ä»£ç æœªè¢«è¦†ç›–

---

## ğŸ’¡ æé«˜è¦†ç›–ç‡çš„æŠ€å·§

### 1. æŸ¥çœ‹æœªè¦†ç›–çš„ä»£ç 

```powershell
pytest tests/ --cov=app --cov-report=html
start htmlcov/index.html
```

ç‚¹å‡»è¦†ç›–ç‡ä½çš„æ–‡ä»¶ï¼ŒæŸ¥çœ‹å“ªäº›ä»£ç æœªè¢«æµ‹è¯•ã€‚

### 2. æ·»åŠ æµ‹è¯•

ä¸ºæœªæµ‹è¯•çš„å‡½æ•°æ·»åŠ æµ‹è¯•ç”¨ä¾‹ï¼š

```python
# åœ¨ tests/test_day4_5.py ä¸­æ·»åŠ 
def test_truncate_text(self):
    """æµ‹è¯•æ–‡å­—æˆªæ–­"""
    from app.utils.helpers import truncate_text
    
    result = truncate_text("Hello World", max_length=5)
    assert result == "He..."
```

### 3. é‡æ–°è¿è¡Œè¦†ç›–ç‡æµ‹è¯•

```powershell
pytest tests/ --cov=app --cov-report=html
```

æŸ¥çœ‹è¦†ç›–ç‡æ˜¯å¦æé«˜ï¼

---

## â“ å¸¸è§é—®é¢˜

### Q: VS Code ä¸­ "Run Test with Coverage" æ²¡ååº”ï¼Ÿ

**A:** æ£€æŸ¥ï¼š
1. âœ… pytest-cov å·²å®‰è£…ï¼Ÿ`pip list | grep pytest-cov`
2. âœ… é‡å¯ VS Code
3. âœ… åˆ·æ–°æµ‹è¯•é¢æ¿ ğŸ”„

---

### Q: è¦†ç›–ç‡æ˜¾ç¤º 0%ï¼Ÿ

**A:** ç¡®ä¿ï¼š
1. âœ… æµ‹è¯•å®é™…è°ƒç”¨äº†ä½ çš„ä»£ç 
2. âœ… ä½¿ç”¨æ­£ç¡®çš„ `--cov` å‚æ•°ï¼ˆä¾‹å¦‚ `--cov=app`ï¼‰

---

### Q: 100% è¦†ç›–ç‡å°±å¤Ÿäº†å—ï¼Ÿ

**A:** ä¸å¤Ÿï¼è¦†ç›–ç‡åªè¡¨ç¤ºä»£ç è¢«æ‰§è¡Œäº†ï¼Œè¿˜éœ€è¦ï¼š
- âœ… æµ‹è¯•å„ç§è¾“å…¥æƒ…å†µ
- âœ… æµ‹è¯•è¾¹ç•Œæ¡ä»¶
- âœ… æµ‹è¯•å¼‚å¸¸æƒ…å†µ

---

## ğŸ“š è¯¦ç»†æ–‡æ¡£

ğŸ“– æŸ¥çœ‹ **COVERAGE_GUIDE.md** è·å–å®Œæ•´æ•™ç¨‹

---

## ğŸ‰ å¿«é€Ÿæ¼”ç¤º

```powershell
# 1. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.\venv\Scripts\activate

# 2. è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡
pytest tests/test_day4_5.py --cov=app --cov-report=html

# 3. æŸ¥çœ‹ç»“æœ
start htmlcov/index.html
```

**ä½ ä¼šçœ‹åˆ°ï¼š**
- ğŸ“Š æ€»ä½“è¦†ç›–ç‡ï¼š35%
- ğŸŸ¢ models/common.pyï¼š100% â† å®Œå…¨è¦†ç›–ï¼
- ğŸŸ¡ utils/helpers.pyï¼š50% â† éœ€è¦æ›´å¤šæµ‹è¯•
- ğŸ”´ utils/logging_config.pyï¼š24% â† éœ€è¦å¤§é‡æµ‹è¯•

---

**ç°åœ¨è¯•è¯•å§ï¼** ğŸš€ğŸ“Š

