# è®¢å•ç®¡ç†ç³»ç»Ÿ - ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨ç”µå•†ç³»ç»Ÿçš„è®¢å•ç®¡ç†åŠŸèƒ½ã€‚è®¢å•ç®¡ç†ç³»ç»Ÿæä¾›å®Œæ•´çš„è®¢å•ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬åˆ›å»ºã€æŸ¥è¯¢ã€çŠ¶æ€æ›´æ–°ã€å–æ¶ˆç­‰åŠŸèƒ½ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨åº”ç”¨

```bash
# ç¡®ä¿ MongoDB æ­£åœ¨è¿è¡Œ
# å¯åŠ¨åç«¯æœåŠ¡
uvicorn app.main:app --reload

# æˆ–ä½¿ç”¨è„šæœ¬
.\start_backend.ps1
```

### 2. åˆ›å»ºè®¢å•ç´¢å¼•

é¦–æ¬¡ä½¿ç”¨å‰ï¼Œéœ€è¦åˆ›å»ºè®¢å•é›†åˆçš„ç´¢å¼•ä»¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼š

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.\venv\Scripts\activate

# åˆ›å»ºæ‰€æœ‰ç´¢å¼•
python scripts/create_order_indexes.py create

# æŸ¥çœ‹ç´¢å¼•ç»Ÿè®¡
python scripts/create_order_indexes.py stats
```

### 3. è®¿é—® API æ–‡æ¡£

æ‰“å¼€æµè§ˆå™¨è®¿é—® Swagger UIï¼š
```
http://localhost:8000/docs
```

---

## ğŸ‘¤ æµ‹è¯•è´¦æˆ·

### ç®¡ç†å‘˜è´¦æˆ·
- **é‚®ç®±**: `admin@ecommerce.com`
- **å¯†ç **: `Admin123!`
- **æƒé™**: æŸ¥çœ‹æ‰€æœ‰è®¢å•ã€æ›´æ–°è®¢å•çŠ¶æ€

### Vendor è´¦æˆ·
- **é‚®ç®±**: `vendor@test.com`
- **å¯†ç **: `Vendor123!`
- **æƒé™**: æŸ¥çœ‹è‡ªå·±çš„è®¢å•ã€æ›´æ–°è®¢å•çŠ¶æ€

### Customer è´¦æˆ·
- **é‚®ç®±**: `customer@test.com`
- **å¯†ç **: `Customer123!`
- **æƒé™**: åˆ›å»ºè®¢å•ã€æŸ¥çœ‹è‡ªå·±çš„è®¢å•ã€å–æ¶ˆè®¢å•

---

## ğŸ“ æ ¸å¿ƒåŠŸèƒ½

### 1. åˆ›å»ºè®¢å•

**ç«¯ç‚¹**: `POST /api/v1/orders`  
**æƒé™**: å·²è®¤è¯ç”¨æˆ·  
**åŠŸèƒ½**: 
- éªŒè¯å•†å“åº“å­˜
- è‡ªåŠ¨æ‰£å‡åº“å­˜
- è®¡ç®—è®¢å•é‡‘é¢ï¼ˆå•†å“æ€»é¢ + è¿è´¹ - æŠ˜æ‰£ï¼‰
- ç”Ÿæˆå”¯ä¸€è®¢å•ç¼–å·
- åˆ›å»ºçŠ¶æ€å†å²è®°å½•

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "items": [
    {
      "product_id": "å•†å“ID",
      "product_name": "iPhone 15 Pro Max",
      "price": 39900.00,
      "quantity": 1,
      "subtotal": 39900.00,
      "attributes": {
        "color": "é’›é‡‘å±",
        "storage": "256GB"
      }
    }
  ],
  "shipping_address": {
    "recipient": "å¼ ä¸‰",
    "phone": "0912345678",
    "address_line1": "å°åŒ—å¸‚ä¸­æ­£åŒºå¿ å­ä¸œè·¯ä¸€æ®µ1å·",
    "address_line2": "10æ¥¼",
    "city": "å°åŒ—å¸‚",
    "state": "å°åŒ—å¸‚",
    "postal_code": "100",
    "country": "Taiwan"
  },
  "payment_method": "credit_card",
  "note": "è¯·åœ¨å‘¨æœ«é€è¾¾"
}
```

**è¿è´¹è®¡ç®—è§„åˆ™**:
- å•†å“æ€»é¢ â‰¥ 1000 å…ƒï¼šå…è¿è´¹
- å•†å“æ€»é¢ â‰¥ 500 å…ƒï¼šè¿è´¹ 50 å…ƒ
- å•†å“æ€»é¢ < 500 å…ƒï¼šè¿è´¹ 100 å…ƒ

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "id": "è®¢å•ID",
    "order_number": "ORD202511211430001234567",
    "status": "pending",
    "payment_status": "pending",
    "subtotal": 39900.00,
    "shipping_fee": 0.00,
    "discount": 0.00,
    "total_amount": 39900.00,
    "created_at": "2025-11-21T10:00:00Z"
  },
  "message": "è®¢å•åˆ›å»ºæˆåŠŸï¼Œè®¢å•ç¼–å·: ORD202511211430001234567"
}
```

---

### 2. æŸ¥è¯¢è®¢å•

#### 2.1 è·å–æˆ‘çš„è®¢å•åˆ—è¡¨

**ç«¯ç‚¹**: `GET /api/v1/orders`  
**æƒé™**: å·²è®¤è¯ç”¨æˆ·  
**æŸ¥è¯¢å‚æ•°**:
- `page`: é¡µç ï¼ˆé»˜è®¤ 1ï¼‰
- `page_size`: æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤ 20ï¼Œæœ€å¤§ 100ï¼‰
- `status`: è®¢å•çŠ¶æ€ç­›é€‰
- `payment_status`: æ”¯ä»˜çŠ¶æ€ç­›é€‰
- `start_date`: å¼€å§‹æ—¥æœŸ
- `end_date`: ç»“æŸæ—¥æœŸ
- `min_amount`: æœ€ä½é‡‘é¢
- `max_amount`: æœ€é«˜é‡‘é¢
- `search`: æœç´¢å…³é”®è¯ï¼ˆè®¢å•ç¼–å·ã€æ”¶ä»¶äººï¼‰
- `sort_by`: æ’åºå­—æ®µï¼ˆcreated_at, updated_at, total_amount, paid_atï¼‰
- `order`: æ’åºæ–¹å‘ï¼ˆasc, descï¼‰

**è¯·æ±‚ç¤ºä¾‹**:
```bash
GET /api/v1/orders?page=1&page_size=10&status=paid&sort_by=created_at&order=desc
Authorization: Bearer <user_token>
```

#### 2.2 è·å–è®¢å•è¯¦æƒ…

**ç«¯ç‚¹**: `GET /api/v1/orders/{order_id}`  
**æƒé™**: è®¢å•æ‰€æœ‰è€… æˆ– admin

**è¯·æ±‚ç¤ºä¾‹**:
```bash
GET /api/v1/orders/507f1f77bcf86cd799439011
Authorization: Bearer <user_token>
```

#### 2.3 æ ¹æ®è®¢å•ç¼–å·æŸ¥è¯¢

**ç«¯ç‚¹**: `GET /api/v1/orders/number/{order_number}`  
**æƒé™**: è®¢å•æ‰€æœ‰è€… æˆ– admin

**è¯·æ±‚ç¤ºä¾‹**:
```bash
GET /api/v1/orders/number/ORD202511211430001234567
Authorization: Bearer <user_token>
```

---

### 3. è®¢å•çŠ¶æ€ç®¡ç†

#### 3.1 è®¢å•çŠ¶æ€æµè½¬

```
å¾…ä»˜æ¬¾ (pending) 
    â†“
å·²ä»˜æ¬¾ (paid)
    â†“
å¾…å‘è´§/å¤„ç†ä¸­ (processing)
    â†“
å·²å‘è´§ (shipped)
    â†“
å·²é€è¾¾ (delivered)
    â†“
å·²å®Œæˆ (completed)

ä»»ä½•çŠ¶æ€ â†’ å·²å–æ¶ˆ (cancelled)
å·²å®Œæˆ â†’ å·²é€€æ¬¾ (refunded)
```

#### 3.2 æ›´æ–°è®¢å•çŠ¶æ€

**ç«¯ç‚¹**: `PUT /api/v1/orders/{order_id}/status`  
**æƒé™**: admin æˆ– vendor

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "status": "shipped",
  "note": "è®¢å•å·²å‘è´§ï¼Œç‰©æµå•å·ï¼šSF1234567890"
}
```

**æ”¯æŒçš„çŠ¶æ€è½¬æ¢**:
- `pending` â†’ `paid`, `cancelled`
- `paid` â†’ `processing`, `cancelled`
- `processing` â†’ `shipped`, `cancelled`
- `shipped` â†’ `delivered`, `completed`
- `delivered` â†’ `completed`, `refunded`
- `completed` â†’ `refunded`

---

### 4. å–æ¶ˆè®¢å•

**ç«¯ç‚¹**: `PUT /api/v1/orders/{order_id}/cancel`  
**æƒé™**: è®¢å•æ‰€æœ‰è€… æˆ– admin

**åŠŸèƒ½**:
- å°†è®¢å•çŠ¶æ€æ›´æ–°ä¸ºå·²å–æ¶ˆ
- è‡ªåŠ¨æ¢å¤å•†å“åº“å­˜
- è®°å½•å–æ¶ˆåŸå› 

**é™åˆ¶**:
- åªæœ‰ `pending`ã€`paid`ã€`processing` çŠ¶æ€çš„è®¢å•å¯ä»¥å–æ¶ˆ
- å·²å‘è´§(`shipped`)æˆ–å·²å®Œæˆ(`completed`)çš„è®¢å•ä¸èƒ½å–æ¶ˆ

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "reason": "ä¸æƒ³è¦äº†"
}
```

---

### 5. è®¢å•ç»Ÿè®¡

**ç«¯ç‚¹**: `GET /api/v1/orders/statistics/summary`  
**æƒé™**: å·²è®¤è¯ç”¨æˆ·ï¼ˆæŸ¥çœ‹è‡ªå·±çš„ç»Ÿè®¡ï¼‰ / adminï¼ˆæŸ¥çœ‹æ‰€æœ‰ç»Ÿè®¡ï¼‰

**æŸ¥è¯¢å‚æ•°**:
- `start_date`: å¼€å§‹æ—¥æœŸï¼ˆå¯é€‰ï¼‰
- `end_date`: ç»“æŸæ—¥æœŸï¼ˆå¯é€‰ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "total_orders": 150,
    "total_amount": 5000000.00,
    "pending_orders": 10,
    "paid_orders": 20,
    "processing_orders": 15,
    "completed_orders": 100,
    "cancelled_orders": 5,
    "average_order_value": 33333.33
  }
}
```

---

## ğŸ§ª ä½¿ç”¨ Swagger UI æµ‹è¯•

### 1. è®¿é—® Swagger UI
```
http://localhost:8000/docs
```

### 2. ç™»å½•è·å– Token

1. å±•å¼€ `POST /api/v1/auth/login`
2. ç‚¹å‡» "Try it out"
3. è¾“å…¥ç™»å½•å‡­è¯ï¼š
   ```json
   {
     "email": "customer@test.com",
     "password": "Customer123!"
   }
   ```
4. ç‚¹å‡» "Execute"
5. å¤åˆ¶å“åº”ä¸­çš„ `access_token`

### 3. æˆæƒ

1. ç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„ "Authorize" æŒ‰é’®
2. åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­è¾“å…¥ï¼š`Bearer <your_token>`
3. ç‚¹å‡» "Authorize"
4. ç°åœ¨å¯ä»¥æµ‹è¯•éœ€è¦è®¤è¯çš„ç«¯ç‚¹äº†

### 4. æµ‹è¯•åˆ›å»ºè®¢å•

1. å…ˆåˆ›å»ºä¸€ä¸ªå•†å“ï¼ˆéœ€è¦ admin æˆ– vendor è´¦æˆ·ï¼‰
2. å¤åˆ¶å•†å“ID
3. å±•å¼€ `POST /api/v1/orders`
4. ä½¿ç”¨å•†å“IDåˆ›å»ºè®¢å•
5. æŸ¥çœ‹å“åº”ä¸­çš„è®¢å•ä¿¡æ¯

---

## ğŸ“Š è®¢å•æ•°æ®ç»“æ„

### OrderResponse

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | string | è®¢å•ID |
| `order_number` | string | è®¢å•ç¼–å· |
| `user_id` | string | ç”¨æˆ·ID |
| `items` | array | è®¢å•å•†å“åˆ—è¡¨ |
| `subtotal` | number | å•†å“æ€»é¢ |
| `shipping_fee` | number | è¿è´¹ |
| `discount` | number | æŠ˜æ‰£é‡‘é¢ |
| `total_amount` | number | è®¢å•æ€»é‡‘é¢ |
| `shipping_address` | object | æ”¶è´§åœ°å€ |
| `status` | string | è®¢å•çŠ¶æ€ |
| `payment_status` | string | æ”¯ä»˜çŠ¶æ€ |
| `payment_method` | string | æ”¯ä»˜æ–¹å¼ |
| `tracking_number` | string | ç‰©æµå•å·ï¼ˆå¯é€‰ï¼‰ |
| `note` | string | è®¢å•å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰ |
| `coupon_code` | string | ä¼˜æƒ åˆ¸ä»£ç ï¼ˆå¯é€‰ï¼‰ |
| `created_at` | datetime | åˆ›å»ºæ—¶é—´ |
| `updated_at` | datetime | æ›´æ–°æ—¶é—´ |
| `paid_at` | datetime | æ”¯ä»˜æ—¶é—´ï¼ˆå¯é€‰ï¼‰ |
| `shipped_at` | datetime | å‘è´§æ—¶é—´ï¼ˆå¯é€‰ï¼‰ |
| `delivered_at` | datetime | é€è¾¾æ—¶é—´ï¼ˆå¯é€‰ï¼‰ |
| `completed_at` | datetime | å®Œæˆæ—¶é—´ï¼ˆå¯é€‰ï¼‰ |
| `cancelled_at` | datetime | å–æ¶ˆæ—¶é—´ï¼ˆå¯é€‰ï¼‰ |
| `status_history` | array | çŠ¶æ€å†å²è®°å½• |

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. åˆ›å»ºè®¢å•å‰
- âœ… ç¡®ä¿ç”¨æˆ·å·²ç™»å½•
- âœ… éªŒè¯å•†å“åº“å­˜å……è¶³
- âœ… ç¡®è®¤æ”¶è´§åœ°å€å®Œæ•´
- âœ… é€‰æ‹©åˆé€‚çš„æ”¯ä»˜æ–¹å¼

### 2. è®¢å•çŠ¶æ€æ›´æ–°
- âœ… éµå¾ªçŠ¶æ€æµè½¬è§„åˆ™
- âœ… æ·»åŠ è¯¦ç»†çš„çŠ¶æ€å˜æ›´å¤‡æ³¨
- âœ… åŠæ—¶é€šçŸ¥ç”¨æˆ·çŠ¶æ€å˜åŒ–

### 3. å–æ¶ˆè®¢å•
- âœ… åªåœ¨å…è®¸çš„çŠ¶æ€ä¸‹å–æ¶ˆ
- âœ… è¯´æ˜å–æ¶ˆåŸå› 
- âœ… ç¡®è®¤åº“å­˜å·²æ¢å¤

### 4. æŸ¥è¯¢ä¼˜åŒ–
- âœ… ä½¿ç”¨åˆ†é¡µé¿å…ä¸€æ¬¡åŠ è½½è¿‡å¤šæ•°æ®
- âœ… ä½¿ç”¨ç­›é€‰æ¡ä»¶ç²¾ç¡®æŸ¥è¯¢
- âœ… åˆç†ä½¿ç”¨æ’åºåŠŸèƒ½

---

## â“ å¸¸è§é—®é¢˜

### Q1: åˆ›å»ºè®¢å•æ—¶æç¤ºåº“å­˜ä¸è¶³ï¼Ÿ
**A**: 
1. æ£€æŸ¥å•†å“å½“å‰åº“å­˜æ˜¯å¦å……è¶³
2. å¯èƒ½æœ‰å…¶ä»–è®¢å•æ­£åœ¨å ç”¨åº“å­˜
3. è”ç³»ç®¡ç†å‘˜ç¡®è®¤å•†å“çŠ¶æ€

### Q2: æ— æ³•å–æ¶ˆå·²å‘è´§çš„è®¢å•ï¼Ÿ
**A**: å·²å‘è´§(`shipped`)ã€å·²é€è¾¾(`delivered`)å’Œå·²å®Œæˆ(`completed`)çŠ¶æ€çš„è®¢å•ä¸å…è®¸ç›´æ¥å–æ¶ˆã€‚å¦‚éœ€å–æ¶ˆï¼Œè¯·è”ç³»å®¢æœæˆ–ç®¡ç†å‘˜å¤„ç†ã€‚

### Q3: è®¢å•çŠ¶æ€æ›´æ–°å¤±è´¥ï¼Ÿ
**A**: 
1. æ£€æŸ¥æ˜¯å¦æœ‰æƒé™æ›´æ–°è®¢å•çŠ¶æ€
2. ç¡®è®¤çŠ¶æ€è½¬æ¢æ˜¯å¦åˆæ³•ï¼ˆå‚è€ƒçŠ¶æ€æµè½¬å›¾ï¼‰
3. æŸ¥çœ‹é”™è¯¯æ¶ˆæ¯è·å–è¯¦ç»†åŸå› 

### Q4: å¦‚ä½•æŸ¥çœ‹è®¢å•çš„å®Œæ•´å†å²è®°å½•ï¼Ÿ
**A**: è·å–è®¢å•è¯¦æƒ…æ—¶ï¼Œ`status_history` å­—æ®µåŒ…å«å®Œæ•´çš„çŠ¶æ€å˜æ›´å†å²ï¼ŒåŒ…æ‹¬æ—¶é—´ã€æ“ä½œäººå’Œå¤‡æ³¨ã€‚

### Q5: è®¢å•é‡‘é¢å¦‚ä½•è®¡ç®—ï¼Ÿ
**A**: 
```
è®¢å•æ€»é‡‘é¢ = å•†å“æ€»é¢ + è¿è´¹ - æŠ˜æ‰£

å…¶ä¸­ï¼š
- å•†å“æ€»é¢ = Î£(å•†å“å•ä»· Ã— æ•°é‡)
- è¿è´¹æ ¹æ®å•†å“æ€»é¢è‡ªåŠ¨è®¡ç®—
- æŠ˜æ‰£æ ¹æ®ä¼˜æƒ åˆ¸è®¡ç®—ï¼ˆå¦‚æœæœ‰ï¼‰
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ï¼šæ— æ³•åˆ›å»ºè®¢å•

**å¯èƒ½åŸå› **:
1. æœªç™»å½•æˆ–Tokenè¿‡æœŸ
2. å•†å“ä¸å­˜åœ¨æˆ–å·²ä¸‹æ¶
3. åº“å­˜ä¸è¶³
4. è¯·æ±‚æ•°æ®æ ¼å¼é”™è¯¯

**è§£å†³æ–¹æ³•**:
1. é‡æ–°ç™»å½•è·å–æ–°Token
2. ç¡®è®¤å•†å“IDæ­£ç¡®ä¸”å•†å“çŠ¶æ€ä¸º `active`
3. æ£€æŸ¥å•†å“åº“å­˜
4. å‚è€ƒAPIæ–‡æ¡£æ£€æŸ¥è¯·æ±‚æ ¼å¼

### é—®é¢˜ï¼šè®¢å•åˆ—è¡¨æŸ¥è¯¢æ…¢

**å¯èƒ½åŸå› **:
1. æœªåˆ›å»ºç´¢å¼•
2. æŸ¥è¯¢æ¡ä»¶è¿‡äºå®½æ³›
3. æ•°æ®é‡å¤ªå¤§æœªåˆ†é¡µ

**è§£å†³æ–¹æ³•**:
1. è¿è¡Œ `python scripts/create_order_indexes.py create`
2. ä½¿ç”¨ç­›é€‰æ¡ä»¶ç¼©å°æŸ¥è¯¢èŒƒå›´
3. ä½¿ç”¨åˆ†é¡µæŸ¥è¯¢ï¼Œå‡å° `page_size`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Phase 4 å®Œæˆæ€»ç»“](../02-development/PHASE4_COMPLETE.md)
- [Phase 4 å¼€å‘è¿›åº¦](../02-development/PHASE4_PROGRESS.md)
- [å•†å“ç®¡ç†æŒ‡å—](./PRODUCT_MANAGEMENT_GUIDE.md)
- [ç”¨æˆ·è§’è‰²å¿«é€Ÿå¼€å§‹](./USER_ROLE_QUICK_START.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-11-21  
**ç»´æŠ¤è€…**: Development Team

